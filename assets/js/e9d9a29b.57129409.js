"use strict";(globalThis.webpackChunkedge_ai=globalThis.webpackChunkedge_ai||[]).push([[824],{7317:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"chat_with_llm","title":"Chat With LLM","description":"The Chat with LLM workshop will guide you through four essential techniques used for interacting with LLMs:","source":"@site/docs/chat_with_llm.md","sourceDirName":".","slug":"/chat_with_llm","permalink":"/docs/chat_with_llm","draft":false,"unlisted":false,"editUrl":"https://github.com/Wyliodrin/edge-ai-101/edit/main/docs/chat_with_llm.md","tags":[],"version":"current","frontMatter":{"position":3},"sidebar":"tutorialSidebar","previous":{"title":"Third-Party Libraries Cheatsheet for Face Auth Workshop","permalink":"/docs/face_authentication/cheatsheet"}}');var i=n(4848),r=n(8453);const a={position:3},l="Chat With LLM",o={},h=[{value:"Slides",id:"slides",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Deploying the models",id:"deploying-the-models",level:3},{value:"Repository",id:"repository",level:2},{value:"Workshop",id:"workshop",level:2},{value:"1. Simple Chat Request",id:"1-simple-chat-request",level:3},{value:"2. Retrieval-Augmented Generation (RAG)",id:"2-retrieval-augmented-generation-rag",level:3},{value:"3. Structured Outputs",id:"3-structured-outputs",level:3},{value:"4. Tool Calling",id:"4-tool-calling",level:3},{value:"5. Extra",id:"5-extra",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"chat-with-llm",children:"Chat With LLM"})}),"\n",(0,i.jsx)(t.p,{children:"The Chat with LLM workshop will guide you through four essential techniques used for interacting with LLMs:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Simple chat request"}),"\n",(0,i.jsx)(t.li,{children:"RAG"}),"\n",(0,i.jsx)(t.li,{children:"Structured outputs"}),"\n",(0,i.jsx)(t.li,{children:"Tool calling"}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:'The application runs in the CLI and expects a user prompt. The user then selects one of the available techniques to interact with the LLM. The model will respond. The messages inside the conversation are stored in memory. The application will keep running until the user types "exit".'}),"\n",(0,i.jsx)(t.h2,{id:"slides",children:"Slides"}),"\n",(0,i.jsx)("iframe",{src:"/slides/2_llm.pdf",loading:"lazy",width:"700",height:"400",children:(0,i.jsx)(t.p,{children:"Not able to display the slides"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)("a",{href:"/slides/2_llm.pdf",target:"_blank",children:"download the slides"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,i.jsx)(t.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(t.p,{children:"The following are already installed on the Raspberry Pi:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://doc.rust-lang.org/cargo/getting-started/installation.html",children:"Cargo"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"https://github.com/ggml-org/llama.cpp/blob/master/docs/build.md#cpu-build",children:"Llama.cpp"})}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"deploying-the-models",children:"Deploying the models"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"llama-server --embeddings --hf-repo second-state/All-MiniLM-L6-v2-Embedding-GGUF --hf-file  all-MiniLM-L6-v2-ggml-model-f16.gguf --port 8081 # embeddings model available on localhost:8081\nllama-server --jinja --hf-repo MaziyarPanahi/gemma-3-1b-it-GGUF --hf-file gemma-3-1b-it.Q5_K_M.gguf # llm available on localhost:8080\n"})}),"\n",(0,i.jsx)(t.h2,{id:"repository",children:"Repository"}),"\n",(0,i.jsx)(t.p,{children:"Please clone the repository."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"git clone https://github.com/Wyliodrin/edge-ai-chat-with-llm.git\ncd edge-ai-chat-with-llm\n"})}),"\n",(0,i.jsx)(t.h2,{id:"workshop",children:"Workshop"}),"\n",(0,i.jsxs)(t.p,{children:["You will be working inside the ",(0,i.jsx)(t.code,{children:"workshop.rs"})," file. The full implementation is available in the ",(0,i.jsx)(t.code,{children:"full_demo.rs"})," file, in case you get stuck.\nIn order to run the workshop, execute:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"RUST_LOG=info cargo run --bin workshop\n"})}),"\n",(0,i.jsx)(t.h3,{id:"1-simple-chat-request",children:"1. Simple Chat Request"}),"\n",(0,i.jsx)(t.p,{children:"During the workshop, we will be using Gemma 3 1B as our language model. The models are deployed using llama.cpp, which exposes an OpenAI-compatible API on port 8080."}),"\n",(0,i.jsx)(t.p,{children:"We have defined the necessary structs to interact with the model API."}),"\n",(0,i.jsx)(t.p,{children:"A chat request consists of the model name, an array of messages and optionally tools and response format."}),"\n",(0,i.jsx)(t.p,{children:"A message consists of the role (user, assistant, system) and the content."}),"\n",(0,i.jsx)(t.p,{children:"Complete the TODO 1 to implement the chat interaction logic."}),"\n",(0,i.jsx)(t.h3,{id:"2-retrieval-augmented-generation-rag",children:"2. Retrieval-Augmented Generation (RAG)"}),"\n",(0,i.jsx)(t.p,{children:"In this section, we will implement a RAG system that combines the language model with a document retrieval system."}),"\n",(0,i.jsx)(t.p,{children:"The embeddings model is also deployed using llama.cpp and exposes a slightly different API on port 8081."}),"\n",(0,i.jsx)(t.p,{children:"A RAG system is implemented as follows:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Calculate embeddings on documents inside the knowledge base."}),"\n",(0,i.jsx)(t.li,{children:"Calculate the embedding of the user query."}),"\n",(0,i.jsx)(t.li,{children:"Store the document embeddings in a vector database (for simplicity, we will use an in-memory vector store)."}),"\n",(0,i.jsx)(t.li,{children:"Get the most similar documents from the knowledge base using the query embedding, with a metric such as cosine similarity."}),"\n",(0,i.jsx)(t.li,{children:"Pass the retrieved documents as context to the language model and generate a response."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"Here are some examples that you can add to the database and ask questions about them:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"The secret code to access the project is 'quantum_leap_42'."}),"\n",(0,i.jsx)(t.li,{children:"Alice is the lead engineer for the new 'Orion' feature."}),"\n",(0,i.jsx)(t.li,{children:"The project deadline has been moved to next Friday."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"For this exercise, solve TODO 2 to implement the document retrieval logic."}),"\n",(0,i.jsx)(t.h3,{id:"3-structured-outputs",children:"3. Structured Outputs"}),"\n",(0,i.jsx)(t.p,{children:"Structured outputs are a way to format the model's responses, such that they can be parsed by other systems. Information extraction is a common use case for structured outputs, where the model is asked to extract specific information from a given text."}),"\n",(0,i.jsx)(t.p,{children:"Structured outputs are defined by a JSON Schema that describes the structure of the expected output."}),"\n",(0,i.jsxs)(t.p,{children:["The schema is passed in the API request in the ",(0,i.jsx)(t.code,{children:"response_format"})," field. An example schema for extracting the city from a given text looks like this:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n    "type": "json_schema",\n    "json_schema": {\n        "name": "example_schema",\n        "schema": {\n            "type": "object",\n            "properties": {\n                "city": {\n                    "type": "string",\n                }\n            }\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["In the background, llama.cpp parses this schema and creates a GBNF grammar that guides the model's response generation. More information in the ",(0,i.jsx)(t.a,{href:"https://github.com/ggml-org/llama.cpp/tree/master/grammars",children:"llama.cpp documentation"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["Keep in mind that using structured outputs can degrade the performance of LLMs, as shown by ",(0,i.jsx)(t.a,{href:"https://arxiv.org/abs/2408.02442",children:"Tam et al."})]}),"\n",(0,i.jsx)(t.p,{children:"For this exercise, solve TODO 3 in order to extract the name, city and age of user from a given text."}),"\n",(0,i.jsxs)(t.p,{children:["Here's an example prompt you can use to test your implementation:\n",(0,i.jsx)(t.code,{children:"John is a 25 years old software engineer living in New York."})]}),"\n",(0,i.jsx)(t.h3,{id:"4-tool-calling",children:"4. Tool Calling"}),"\n",(0,i.jsx)(t.p,{children:"LLMs are very good at generating text, but they are not very good at performing tasks that require letter-perfect accuracy, such as calculations. Try asking the model to calculate the sum of two numbers over 10000, and you will see that it often makes mistakes.\nThese weaknesses can be mitigated by using tools, which are functions that can be called by the model to perform specific tasks."}),"\n",(0,i.jsx)(t.p,{children:"Tool calling is a technique that builds on structured outputs. It allows the user to define functions that can be called by the language model and executed during the conversation."}),"\n",(0,i.jsx)(t.p,{children:"Tool calling also uses structured outputs under the hood, as defining a tool is done using a JSON Schema."}),"\n",(0,i.jsx)(t.p,{children:"A tool for calculating the sum of two numbers might look like this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'[\n    {\n        "type": "function",\n        "function": {\n            "name": "add",\n            "description": "Add two numbers.",\n            "parameters": {\n                "type": "object",\n                "properties": {\n                    "num1": {\n                        "type": "integer",\n                        "description": "The first number."\n                    },\n                    "num2": {\n                        "type": "integer",\n                        "description": "The second number."\n                    },\n                },\n                "required": [\n                    "num1",\n                    "num2",\n                ]\n            }\n        }\n    }\n]\n'})}),"\n",(0,i.jsx)(t.p,{children:"In this exercise, solve TODO 4 to implement a tool that calculates mathematical operations (add, subtract, multiply, divide) between two numbers."}),"\n",(0,i.jsx)(t.h3,{id:"5-extra",children:"5. Extra"}),"\n",(0,i.jsx)(t.p,{children:"Congratulations, you implemented a basic agent! If you want to extend it, you can try these other options:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Replace the in-memory RAG implementation with a proper vector database (e.g. Qdrant)."}),"\n",(0,i.jsx)(t.li,{children:"Add more tools for the agent to use - e.g. a web search tool, a bash file finding tool, etc."}),"\n",(0,i.jsxs)(t.li,{children:["Try to extract data from other types of documents (e.g. logs) or use other data types of ",(0,i.jsx)(t.a,{href:"https://json-schema.org/understanding-json-schema/reference/type",children:"JSON Schema"})," (e.g. arrays, enums)."]}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var s=n(6540);const i={},r=s.createContext(i);function a(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:t},e.children)}}}]);